<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Hw07 - Geostatistics Homework (Spatial Dependence)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="geo-hw-spdep_files/libs/clipboard/clipboard.min.js"></script>
<script src="geo-hw-spdep_files/libs/quarto-html/quarto.js"></script>
<script src="geo-hw-spdep_files/libs/quarto-html/popper.min.js"></script>
<script src="geo-hw-spdep_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="geo-hw-spdep_files/libs/quarto-html/anchor.min.js"></script>
<link href="geo-hw-spdep_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="geo-hw-spdep_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="geo-hw-spdep_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="geo-hw-spdep_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="geo-hw-spdep_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Hw07 - Geostatistics Homework (Spatial Dependence)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The <code>ox.rda</code> file contains 126 soil augerings on a 100 x 100m square grid, with 6 columns and 21 rows. Grid is oriented with long axis North-north-west to South-south-east Origin of grid is South-south-east point, 100m outside grid.</p>
<p>The original data are part of a soil survey carried out by P.A. Burrough in 1967. The survey area is located on the chalk downlands on the Berkshire Downs in Oxfordshire, UK. The data frame contains the following variables:</p>
<ul>
<li><code>x</code>: x-coordinate, field, non-projected.</li>
<li><code>y</code>: y-coordinate, field, non-projected.</li>
<li><code>k</code>: K (potassium), 0-20 cm, ppm.</li>
</ul>
<p>These data are a subset of the <code>oxford</code> data set contained in the <strong>gstat</strong> package.</p>
<p>Load the <code>ox</code> data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'gstat' was built under R version 4.3.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The legacy packages maptools, rgdal, and rgeos, underpinning the sp package,
which was just loaded, will retire in October 2023.
Please refer to R-spatial evolution reports for details, especially
https://r-spatial.org/r/2023/05/15/evolution4.html.
It may be desirable to make the sf package available;
package maintainers should consider adding sf to Suggests:.
The sp package is now running under evolution status 2
     (status 2 uses the sf package in place of rgdal)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>--------------------------------------------------------------
 Analysis of Geostatistical Data
 For an Introduction to geoR go to http://www.leg.ufpr.br/geoR
 geoR version 1.9-2 (built on 2022-08-09) is now loaded
--------------------------------------------------------------</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">'ox.rda'</span>)  <span class="co"># load data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>ox_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_as_sf</span>(ox,<span class="at">coords=</span><span class="fu">c</span>(<span class="st">'x'</span>,<span class="st">'y'</span>))  <span class="co"># create sf object</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>gsox <span class="ot">&lt;-</span>  <span class="fu">gstat</span>(<span class="at">id =</span> <span class="st">"k"</span>, <span class="at">formula =</span> k <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> ox_sf)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>grox <span class="ot">&lt;-</span> <span class="fu">as.geodata</span>(<span class="fu">cbind</span>(ox<span class="sc">$</span>x, ox<span class="sc">$</span>y, ox<span class="sc">$</span>k))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then:</p>
<ol type="1">
<li>Use the <code>ox</code> data frame to create an <code>sf</code> object using <code>x</code> and <code>y</code> as coordinates.</li>
<li>Use the <code>sf</code> <code>data.frame</code> to construct a <code>gstat</code> object using <code>k</code> as the response with a constant mean.</li>
<li>Construct a <code>geodata</code> object (from the <strong>geoR</strong> package) with <code>k</code> as the response.</li>
</ol>
<section id="problem-1" class="level1">
<h1>Problem 1</h1>
<p>Create a bubble plot of the observed data using 10 bins from 0 to 10 in increments of 1.</p>
<p><strong>Solution</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ox_sf[<span class="st">"k"</span>], <span class="at">nbreaks =</span> <span class="dv">10</span>, <span class="at">pal =</span> hcl.colors, <span class="at">pch =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="geo-hw-spdep_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="problem-2-using-gstat" class="level1">
<h1>Problem 2 (Using <strong>gstat</strong>)</h1>
<section id="a" class="level2">
<h2 class="anchored" data-anchor-id="a">(a)</h2>
<p>Create a <code>gstat</code> variogram object. The cutoff distance should be 600. The width of each lag interval should be the cutoff distance divided by 16. Plot this object. Does the semivariogram seem to have a well-defined structure? If so, what are the sill, nugget effect, and range, approximately?</p>
<p><strong>Solution</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute empirical semivariogram</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>vhat <span class="ot">=</span> <span class="fu">variogram</span>(gsox, <span class="at">cutoff =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">600</span><span class="sc">/</span><span class="dv">16</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vhat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="geo-hw-spdep_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<blockquote class="blockquote">
<p>The semivariogram has some definition and we can identify the nugget effect as about 6400, the sill appears to be just over 8000, and the range looks to be about 200.</p>
</blockquote>
</section>
<section id="b" class="level2">
<h2 class="anchored" data-anchor-id="b">(b)</h2>
<p>Fit exponential, spherical, and Matern semivariogram models to the empirical semivariogram in (a) using WRSS. Use <code>fit.kappa = TRUE</code> for the Matern model to estimate the associated smoothness parameter.</p>
<p>Use a table to summarize the estimated partial sill, range parameter, and nugget for each model. What is the estimated smoothness parameter for the Matern model?</p>
<p><strong>Solution</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># declaring an empty data frame </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">model =</span> <span class="fu">character</span>(), </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">psill =</span> <span class="fu">double</span>(), </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">range =</span> <span class="fu">double</span>(),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">wrss =</span> <span class="fu">double</span>(),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>) </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># print the data frame </span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># str(df)</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># result = as.data.frame(colnames(list('model','psill','range','wrss')))</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co"># exponential</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>fitexp <span class="ot">=</span> <span class="fu">fit.variogram</span>(vhat,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">vgm</span>( <span class="st">"Exp"</span>, <span class="at">range=</span><span class="dv">200</span>, <span class="at">nugget=</span><span class="dv">6400</span>),</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fit.method =</span> <span class="dv">2</span>)</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vhat, fitexp, <span class="at">main =</span> <span class="st">"WRSS exponential fit"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="geo-hw-spdep_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>rss1 <span class="ot">=</span> <span class="fu">attr</span>(fitexp, <span class="st">"SSErr"</span>) <span class="co"># wrss of fit</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">1</span>,<span class="st">"model"</span>] <span class="ot">=</span> <span class="st">"Exp"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">1</span>,<span class="st">"psill"</span>] <span class="ot">=</span> fitexp[<span class="dv">2</span>,<span class="st">"psill"</span>]</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">1</span>,<span class="st">"range"</span>] <span class="ot">=</span> fitexp[<span class="dv">2</span>,<span class="st">"range"</span>]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">1</span>,<span class="st">"wrss"</span>] <span class="ot">=</span> rss1</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># result$wrss[1] = rss1</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># spherical</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>fitsphere <span class="ot">=</span> <span class="fu">fit.variogram</span>(vhat,</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">vgm</span>(<span class="dv">1600</span>, <span class="st">"Sph"</span>, <span class="dv">200</span>, <span class="dv">6400</span>),</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fit.method =</span> <span class="dv">2</span>)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vhat, fitsphere, <span class="at">main =</span> <span class="st">"Spherical"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="geo-hw-spdep_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>rss2 <span class="ot">=</span> <span class="fu">attr</span>(fitsphere, <span class="st">"SSErr"</span>) <span class="co"># wrss of fit</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">2</span>,<span class="st">"model"</span>] <span class="ot">=</span> <span class="st">"Sph"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">2</span>,<span class="st">"psill"</span>] <span class="ot">=</span> fitsphere[<span class="dv">2</span>,<span class="st">"psill"</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">2</span>,<span class="st">"range"</span>] <span class="ot">=</span> fitsphere[<span class="dv">2</span>,<span class="st">"range"</span>]</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">2</span>,<span class="st">"wrss"</span>] <span class="ot">=</span> rss2</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># result$wrss[2] = rss2</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co"># matern</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>fitmat <span class="ot">=</span> <span class="fu">fit.variogram</span>(vhat,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">vgm</span>(<span class="dv">1600</span>, <span class="st">"Mat"</span>, <span class="dv">200</span>, <span class="dv">6400</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fit.method =</span> <span class="dv">2</span>,<span class="at">fit.kappa =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, : No
convergence after 200 iterations: try different initial values?</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, : No
convergence after 200 iterations: try different initial values?</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit

Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(o, m, fit.kappa = FALSE, fit.method = fit.method, :
singular model in variogram fit</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in fit.variogram(object, model, fit.sills = fit.sills, fit.ranges =
fit.ranges, : singular model in variogram fit</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vhat, fitmat, <span class="at">main =</span> <span class="st">"Matern"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="geo-hw-spdep_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>rss3 <span class="ot">=</span> <span class="fu">attr</span>(fitmat, <span class="st">"SSErr"</span>) <span class="co"># wrss of fit</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">3</span>,<span class="st">"model"</span>] <span class="ot">=</span> <span class="st">"Mat"</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">3</span>,<span class="st">"psill"</span>] <span class="ot">=</span> fitmat[<span class="dv">2</span>,<span class="st">"psill"</span>]</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">3</span>,<span class="st">"range"</span>] <span class="ot">=</span> fitmat[<span class="dv">2</span>,<span class="st">"range"</span>]</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">3</span>,<span class="st">"wrss"</span>] <span class="ot">=</span> rss3</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co"># result$wrss[3] = rss3</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  model    psill     range       wrss
1   Exp 8479.252  59.96227  0.3181106
2   Sph 7174.180 173.76091 10.1002295
3   Mat 8480.321  78.77511  0.1070215</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>the estimated smoothness for the Matern model is 0.107</p>
</blockquote>
</section>
<section id="c" class="level2">
<h2 class="anchored" data-anchor-id="c">(c)</h2>
<p>In one plot, overlay each fitted variogram model from (c) to the empirical semivariogram found in (b). Note: You will need to extract the relevant information from your gstat variogram object. Also, you will probably want to use the <code>variogramLine</code> function to obtain values for the theoretical models of each fitted model. Use this information to construct a single plot with the empirical semivariogram and the fitted models, making sure to label each model properly.</p>
<p><strong>Solution</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>vhat <span class="ot">=</span> <span class="fu">variogram</span>(gsox, <span class="at">cutoff =</span> <span class="dv">600</span>, <span class="at">width =</span> <span class="dv">600</span><span class="sc">/</span><span class="dv">16</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>exp_line <span class="ot">=</span> <span class="fu">variogramLine</span>(fitexp,<span class="at">maxdist =</span> <span class="fu">max</span>(vhat<span class="sc">$</span>dist))</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>sph_line <span class="ot">=</span> <span class="fu">variogramLine</span>(fitsphere,<span class="at">maxdist =</span> <span class="fu">max</span>(vhat<span class="sc">$</span>dist))</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>mat_line <span class="ot">=</span> <span class="fu">variogramLine</span>(fitmat,<span class="at">maxdist =</span> <span class="fu">max</span>(vhat<span class="sc">$</span>dist))</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(vhat, <span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>dist,<span class="at">y=</span>gamma,<span class="at">color=</span><span class="st">'red'</span>))<span class="sc">+</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(exp_line,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>dist,<span class="at">y=</span>gamma,<span class="at">color=</span><span class="st">'darkgreen'</span>))<span class="sc">+</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(sph_line,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>dist,<span class="at">y=</span>gamma,<span class="at">color=</span><span class="st">'orange'</span>))<span class="sc">+</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(mat_line,<span class="at">mapping=</span><span class="fu">aes</span>(<span class="at">x=</span>dist,<span class="at">y=</span>gamma,<span class="at">color=</span><span class="st">'darkblue'</span>))<span class="sc">+</span></span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">name =</span> <span class="st">'Variogram Model'</span>,<span class="at">aesthetics =</span> <span class="st">"color"</span>,</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">values=</span><span class="fu">c</span>(<span class="st">'red'</span><span class="ot">=</span><span class="st">'red'</span>,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'darkgreen'</span><span class="ot">=</span><span class="st">'darkgreen'</span>,</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'orange'</span><span class="ot">=</span><span class="st">'orange'</span>,</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>                               <span class="st">'darkblue'</span><span class="ot">=</span><span class="st">'darkblue'</span>),</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">'Mat'</span>,<span class="st">'Exp'</span>,<span class="st">'Sph'</span>,<span class="st">'vhat'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="geo-hw-spdep_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="problem-3-using-geor" class="level1">
<h1>Problem 3 (Using <strong>geoR</strong>)</h1>
<section id="a-1" class="level2">
<h2 class="anchored" data-anchor-id="a-1">(a)</h2>
<p>Use the geoR <code>variog</code> function to create an empirical semivariogram. The <code>max.dist</code> value should be the same as the cutoff from Problem 2. Use 20 lag intervals. Plot this object.</p>
<p><strong>Solution</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoR)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># load smoky dataframe</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"ox.rda"</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co"># create geodata object for geoR</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>geox <span class="ot">=</span> <span class="fu">as.geodata</span>(<span class="fu">cbind</span>(ox<span class="sc">$</span>x, ox<span class="sc">$</span>y, ox<span class="sc">$</span>k))</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co"># estimated semivariogram</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>vhat2 <span class="ot">=</span> <span class="fu">variog</span>(geox, <span class="at">max.dist =</span> <span class="dv">600</span>, <span class="at">uvec =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>variog: computing omnidirectional variogram</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vhat2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="geo-hw-spdep_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="b-1" class="level2">
<h2 class="anchored" data-anchor-id="b-1">(b)</h2>
<p>(Fit exponential, spherical, and Matern variogram models to empirical semivariogram in (a) using WRSS. Use <code>fix.kappa = FALSE</code> for the Matern model to estimate the associated smoothness parameter. Use a table to summarize the estimated partial sill, range parameter, and nugget for each model. Provide plots of each fitted variogram model to the empirical variogram. What is the estimated smoothness parameter for the Matern model?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>result2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">model =</span> <span class="fu">character</span>(), </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">psill =</span> <span class="fu">double</span>(), </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">range_param =</span> <span class="fu">double</span>(),</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">wrss =</span> <span class="fu">double</span>(),</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co"># fit exponential model using geoR package</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>fitexp <span class="ot">=</span> <span class="fu">variofit</span>(vhat2, <span class="at">ini.cov.pars =</span> <span class="fu">c</span>(<span class="dv">1600</span>, <span class="dv">200</span>),</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nugget =</span> <span class="dv">6400</span>,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cov.model =</span> <span class="st">"exponential"</span>,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>                  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>variofit: covariance model used is exponential 
variofit: weights used: npairs 
variofit: minimisation function used: optim </code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>exp_params1 <span class="ot">&lt;-</span> fitexp<span class="sc">$</span>cov.pars </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>exp_c0 <span class="ot">&lt;-</span> fitexp<span class="sc">$</span>nugget </span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>exp_wrss <span class="ot">&lt;-</span> fitexp<span class="sc">$</span>value<span class="sc">/</span><span class="dv">2</span> </span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>result2[<span class="dv">1</span>,<span class="st">"model"</span>] <span class="ot">=</span> <span class="st">"Exp"</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>result2[<span class="dv">1</span>,<span class="st">"psill"</span>] <span class="ot">=</span> exp_params1[[<span class="dv">1</span>]]</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>result2[<span class="dv">1</span>,<span class="st">"range_param"</span>] <span class="ot">=</span> exp_params1[[<span class="dv">2</span>]]</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>result2[<span class="dv">1</span>,<span class="st">"wrss"</span>] <span class="ot">=</span> exp_wrss</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co"># fit spherical model using geoR package</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>fit_sph <span class="ot">=</span> <span class="fu">variofit</span>(vhat2, <span class="at">ini.cov.pars =</span> <span class="fu">c</span>(<span class="dv">1600</span>, <span class="dv">200</span>),</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nugget =</span> <span class="dv">6400</span>,</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cov.model =</span> <span class="st">"spherical"</span>,</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>                  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>variofit: covariance model used is spherical 
variofit: weights used: npairs 
variofit: minimisation function used: optim </code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>sph_params1 <span class="ot">&lt;-</span> fit_sph<span class="sc">$</span>cov.pars </span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>sph_c0 <span class="ot">&lt;-</span> fit_sph<span class="sc">$</span>nugget </span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>sph_wrss <span class="ot">&lt;-</span> fit_sph<span class="sc">$</span>value<span class="sc">/</span><span class="dv">2</span> </span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>result2[<span class="dv">2</span>,<span class="st">"model"</span>] <span class="ot">=</span> <span class="st">"Sph"</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>result2[<span class="dv">2</span>,<span class="st">"psill"</span>] <span class="ot">=</span> sph_params1[[<span class="dv">1</span>]]</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>result2[<span class="dv">2</span>,<span class="st">"range_param"</span>] <span class="ot">=</span> sph_params1[[<span class="dv">2</span>]]</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>result2[<span class="dv">2</span>,<span class="st">"wrss"</span>] <span class="ot">=</span> sph_wrss</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a><span class="co"># fit matern model</span></span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>fit_mat <span class="ot">=</span> <span class="fu">variofit</span>(vhat2, <span class="at">ini.cov.pars =</span> <span class="fu">c</span>(<span class="dv">1600</span>, <span class="dv">200</span>),</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nugget =</span> <span class="dv">6400</span>,</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cov.model =</span> <span class="st">"matern"</span>,</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fix.kappa =</span> <span class="cn">FALSE</span></span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>                  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>variofit: covariance model used is matern 
variofit: weights used: npairs 
variofit: minimisation function used: optim </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in cov.spatial(g.l$u, cov.model = g.l$cov.model, kappa = kappa, :
Infinity value in cov.spatial

Warning in cov.spatial(g.l$u, cov.model = g.l$cov.model, kappa = kappa, :
Infinity value in cov.spatial

Warning in cov.spatial(g.l$u, cov.model = g.l$cov.model, kappa = kappa, :
Infinity value in cov.spatial

Warning in cov.spatial(g.l$u, cov.model = g.l$cov.model, kappa = kappa, :
Infinity value in cov.spatial

Warning in cov.spatial(g.l$u, cov.model = g.l$cov.model, kappa = kappa, :
Infinity value in cov.spatial

Warning in cov.spatial(g.l$u, cov.model = g.l$cov.model, kappa = kappa, :
Infinity value in cov.spatial

Warning in cov.spatial(g.l$u, cov.model = g.l$cov.model, kappa = kappa, :
Infinity value in cov.spatial

Warning in cov.spatial(g.l$u, cov.model = g.l$cov.model, kappa = kappa, :
Infinity value in cov.spatial

Warning in cov.spatial(g.l$u, cov.model = g.l$cov.model, kappa = kappa, :
Infinity value in cov.spatial</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mat_params1 <span class="ot">&lt;-</span> fit_mat<span class="sc">$</span>cov.pars </span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>mat_c0 <span class="ot">&lt;-</span> fit_mat<span class="sc">$</span>nugget </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>mat_wrss <span class="ot">&lt;-</span> fit_mat<span class="sc">$</span>value<span class="sc">/</span><span class="dv">2</span> </span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>result2[<span class="dv">3</span>,<span class="st">"model"</span>] <span class="ot">=</span> <span class="st">"Exp"</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>result2[<span class="dv">3</span>,<span class="st">"psill"</span>] <span class="ot">=</span> mat_params1[[<span class="dv">1</span>]]</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>result2[<span class="dv">3</span>,<span class="st">"range_param"</span>] <span class="ot">=</span> mat_params1[[<span class="dv">2</span>]]</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>result2[<span class="dv">3</span>,<span class="st">"wrss"</span>] <span class="ot">=</span> mat_wrss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="c-1" class="level2">
<h2 class="anchored" data-anchor-id="c-1">(c)</h2>
<p>In one plot, overlay each fitted variogram model from (b) to the empirical semivariogram found in (a). Making sure to label each model properly.</p>
<p><strong>Solution</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vhat2<span class="sc">$</span>u,vhat2<span class="sc">$</span>v,<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>geoR<span class="sc">:::</span><span class="fu">lines.variomodel.variofit</span>(fitexp,<span class="at">col=</span><span class="st">'green'</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>geoR<span class="sc">:::</span><span class="fu">lines.variomodel.variofit</span>(fit_sph,<span class="at">col=</span><span class="st">'blue'</span>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>geoR<span class="sc">:::</span><span class="fu">lines.variomodel.variofit</span>(fit_mat,<span class="at">col=</span><span class="st">'orange'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="geo-hw-spdep_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="d" class="level2">
<h2 class="anchored" data-anchor-id="d">(d)</h2>
<p>Use the <code>variog4</code> function to create a directional semivariogram (using the default direction). Set <code>maxdist</code> to be 600. Use 10 bins. Plot this object. What kind of anisotropy does this appear to be? Why? (Note that there are few observations in certain bins, so there may be some “missing” data).</p>
<p><strong>Solution</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>dv <span class="ot">&lt;-</span> <span class="fu">variog4</span>(geox,<span class="at">uvec=</span><span class="dv">10</span>,<span class="at">max.dist =</span> <span class="dv">600</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>variog: computing variogram for direction = 0 degrees (0 radians)
        tolerance angle = 22.5 degrees (0.393 radians)
variog: computing variogram for direction = 45 degrees (0.785 radians)
        tolerance angle = 22.5 degrees (0.393 radians)
variog: computing variogram for direction = 90 degrees (1.571 radians)
        tolerance angle = 22.5 degrees (0.393 radians)
variog: computing variogram for direction = 135 degrees (2.356 radians)
        tolerance angle = 22.5 degrees (0.393 radians)
variog: computing omnidirectional variogram</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="geo-hw-spdep_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<blockquote class="blockquote">
<p>from the plot, it appears to be geometric anisotropy because the directional semivariograms have approximately the same shape and sill but it is hard to compare the range between orthogonal directions, which would help with the second condition for geometric anisotropy - that the range in one direction has the max range and the range of the perpendicular direction would be the min range.</p>
</blockquote>
</section>
<section id="e" class="level2">
<h2 class="anchored" data-anchor-id="e">(e)</h2>
<p>Use REML to fit an omnidirectional spherical semivariogram model to the observed data. Then fit a directional semivariogram model with <code>psiA = pi/2</code> and <code>psiR = 1</code>. Make sure that the <code>psiA</code> and <code>psiR</code> parameters are not fixed during estimation for the second parameter. For both models use initial values of 6000 for the partial sill, 50 for the range parameter, and 1000 for the nugget. Note: this will take a fair bit of time. Which model should be preferred, in terms of AIC?</p>
<p><strong>Solution</strong></p>
</section>
</section>
<section id="problem-3" class="level1">
<h1>Problem 3</h1>
<p>Write code to manually construct and plot an omnidirectional semivariogram for the oxford data. Use 16 lag intervals and a distance upper bound of 600. Some steps to do this:</p>
<section id="a-2" class="level2">
<h2 class="anchored" data-anchor-id="a-2">(a)</h2>
<p>Create a matrix that describes the indices of all unique pairs of points <span class="math inline">\((1, 2), (1, 3), (1, N), (2, 3), .., (2, N), \ldots, (N-1, N)\)</span>. Each row should be a different pair.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get x and y vectors, combine into 2d Array</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>vx <span class="ot">&lt;-</span> ox<span class="sc">$</span>x</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>vy <span class="ot">&lt;-</span> ox<span class="sc">$</span>y</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">cbind</span>(vx,vy)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co"># look at uniqe values for x and y</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>N<span class="ot">=</span><span class="fu">length</span>(<span class="fu">unique</span>(vx))</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(vy))</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co"># N =10</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="co"># empty data.frame to store results</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>v_list <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a><span class="co"># instantiate index parameter</span></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>index <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="co"># loop through N-1 and generate index points for each unique (x,y) combination</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(N<span class="dv">-1</span>)){</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (i<span class="sc">+</span>u<span class="sc">&lt;=</span>Z){</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>    v_list[index,<span class="dv">1</span>] <span class="ot">=</span> i</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>    v_list[index,<span class="dv">2</span>] <span class="ot">=</span> i<span class="sc">+</span>u</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a>    u <span class="ot">=</span> u<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a>    index<span class="ot">=</span>index<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to matrix and view</span></span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>v_mat <span class="ot">=</span> <span class="fu">as.matrix</span>(<span class="at">x=</span>v_list,<span class="at">nrow=</span>index<span class="dv">-1</span>,<span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>v_mat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   V1 V2
1   1  2
2   1  3
3   1  4
4   1  5
5   1  6
6   1  7
7   1  8
8   1  9
9   1 10
10  1 11
11  1 12
12  1 13
13  1 14
14  1 15
15  1 16
16  1 17
17  1 18
18  1 19
19  1 20
20  1 21
21  2  3
22  2  4
23  2  5
24  2  6
25  2  7
26  2  8
27  2  9
28  2 10
29  2 11
30  2 12
31  2 13
32  2 14
33  2 15
34  2 16
35  2 17
36  2 18
37  2 19
38  2 20
39  2 21
40  3  4
41  3  5
42  3  6
43  3  7
44  3  8
45  3  9
46  3 10
47  3 11
48  3 12
49  3 13
50  3 14
51  3 15
52  3 16
53  3 17
54  3 18
55  3 19
56  3 20
57  3 21
58  4  5
59  4  6
60  4  7
61  4  8
62  4  9
63  4 10
64  4 11
65  4 12
66  4 13
67  4 14
68  4 15
69  4 16
70  4 17
71  4 18
72  4 19
73  4 20
74  4 21
75  5  6
76  5  7
77  5  8
78  5  9
79  5 10
80  5 11
81  5 12
82  5 13
83  5 14
84  5 15
85  5 16
86  5 17
87  5 18
88  5 19
89  5 20
90  5 21</code></pre>
</div>
</div>
</section>
<section id="b-2" class="level2">
<h2 class="anchored" data-anchor-id="b-2">(b)</h2>
<p>Compute the distances between all unique pairs of observed points. The distances for the unique pairs should be stored in a vector (in the same order as 1). <strong>Print the range of these distances.</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>dv <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">apply</span>(v,<span class="at">FUN=</span>dist,<span class="at">MARGIN=</span><span class="dv">1</span>))</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(dv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]    0 2000</code></pre>
</div>
</div>
</section>
<section id="c-2" class="level2">
<h2 class="anchored" data-anchor-id="c-2">(c)</h2>
<p>Compute the squared difference between the responses for all unique pairs of points (in the same order as 1). <strong>Print the range of the square response differences</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the following assumes we are referring to the y value as our "response"</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co"># u_vy &lt;- as.matrix(unique(vy))</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>uv <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">unique</span>(v))</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>responses <span class="ot">=</span> <span class="fu">as.matrix</span>(uv[,<span class="dv">2</span>])</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="co">#result df</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>r_mat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="co"># set index</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (u <span class="cf">in</span> responses){</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># t_mask = which(uv[,1]==u)</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">=</span> <span class="fu">sapply</span>(responses,<span class="at">FUN=</span><span class="st">"-"</span>,u)</span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>  r2 <span class="ot">=</span> r<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># td = apply(uv[t_mask,],FUN=function(x){</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   r = dist(x)</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   r2 = r^2</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   return(r2)</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># },MARGIN=1)</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># print(as.matrix(td))</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>  r_mat[idx,<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(r2)] <span class="ot">=</span> r2</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>  idx<span class="ot">=</span>idx<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(r_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0e+00 4e+06</code></pre>
</div>
</div>
</section>
<section id="d-1" class="level2">
<h2 class="anchored" data-anchor-id="d-1">(d)</h2>
<p>Determine the endpoints for your lag intervals/tolerance regions using a max distance of 600 and 16 bins. <strong>Print the endpoints</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>hmin <span class="ot">=</span> <span class="fu">min</span>(dv)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>hmax <span class="ot">=</span> <span class="fu">max</span>(dv)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>hlim <span class="ot">=</span> <span class="dv">600</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>n_bins <span class="ot">=</span> <span class="dv">16</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>lag <span class="ot">=</span> (hmax<span class="sc">-</span>hmin)<span class="sc">/</span>n_bins</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span>hmin</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>endpoints <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (b <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_bins){</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  endpoints[b,<span class="dv">1</span>] <span class="ot">=</span> a</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  endpoints[b,<span class="dv">2</span>] <span class="ot">=</span> a<span class="sc">+</span>lag</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  a<span class="ot">=</span>a<span class="sc">+</span>lag</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(endpoints)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     V1   V2
1     0  125
2   125  250
3   250  375
4   375  500
5   500  625
6   625  750
7   750  875
8   875 1000
9  1000 1125
10 1125 1250
11 1250 1375
12 1375 1500
13 1500 1625
14 1625 1750
15 1750 1875
16 1875 2000</code></pre>
</div>
</div>
</section>
<section id="e-1" class="level2">
<h2 class="anchored" data-anchor-id="e-1">(e)</h2>
<p>Use the <code>cut</code> function to bin the distances based on their associated tolerance region.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>bin_factors <span class="ot">=</span> <span class="fu">cut</span>(<span class="at">x=</span>dv,<span class="at">breaks=</span>endpoints[,<span class="dv">1</span>],<span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="f" class="level2">
<h2 class="anchored" data-anchor-id="f">(f)</h2>
<p>Use the <code>tapply</code> function to average the distances in each bin using the labels from the cut function. <strong>Print the results</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">dist=</span>dv,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">points=</span>v,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">bins=</span>bin_factors</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>db <span class="ot">&lt;-</span> <span class="fu">tapply</span>(dt<span class="sc">$</span>dist,bin_factors,mean)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(db)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          [,1]
[0,125]               64.70588
(125,250]            200.00000
(250,375]            300.00000
(375,500]            446.66667
(500,625]            600.00000
(625,750]            700.00000
(750,875]            800.00000
(875,1e+03]          950.00000
(1e+03,1.12e+03]    1100.00000
(1.12e+03,1.25e+03] 1200.00000
(1.25e+03,1.38e+03] 1300.00000
(1.38e+03,1.5e+03]  1450.00000
(1.5e+03,1.62e+03]  1600.00000
(1.62e+03,1.75e+03] 1700.00000
(1.75e+03,1.88e+03] 1800.00000</code></pre>
</div>
</div>
</section>
<section id="g" class="level2">
<h2 class="anchored" data-anchor-id="g">(g)</h2>
<p>Use the <code>tapply</code> function to average the squared response differences in each bin using the labels from the cut function. Then divide by 2. <strong>Print the results</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># i spent way too long trying to get this right..</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="co"># i think I am not understanding how to use the square diff responses</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co"># from before so i just did it all here</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>rd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>idx <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (x <span class="cf">in</span> endpoints[,<span class="dv">2</span>]){</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">=</span> <span class="fu">which</span>(v[,<span class="dv">1</span>]<span class="sc">&lt;=</span>x)</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>  td <span class="ot">=</span> v[m,]</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">=</span> <span class="fu">apply</span>(td,<span class="st">"-"</span>,<span class="at">MARGIN=</span><span class="dv">2</span>)</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>  r2 <span class="ot">=</span> r<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>  mx <span class="ot">=</span> <span class="fu">mean</span>(r2)<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>  rd[idx,<span class="dv">1</span>]<span class="ot">=</span>x</span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>  rd[idx,<span class="dv">2</span>]<span class="ot">=</span>mx</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>  idx<span class="ot">=</span> idx<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a><span class="fu">as.matrix</span>(rd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     V1       V2
1   125 396666.7
2   250 400416.7
3   375 405833.3
4   500 421666.7
5   625 432083.3
6   750 432083.3
7   875 432083.3
8  1000 432083.3
9  1125 432083.3
10 1250 432083.3
11 1375 432083.3
12 1500 432083.3
13 1625 432083.3
14 1750 432083.3
15 1875 432083.3
16 2000 432083.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># responses</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co"># sqd &lt;- tapply(r_mat,bin_factors,mean)</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="co"># sqd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="h" class="level2">
<h2 class="anchored" data-anchor-id="h">(h)</h2>
<p>Plot the result of g (y-axis) vs the result of f (x-axis). Set the y-axis limits to be from 0 to 9000.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># if I set y-axis limit to 9000 then the plot will not show.</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co"># i imagine this is because my response variable is not being measured correctly.</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="geo-hw-spdep_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>