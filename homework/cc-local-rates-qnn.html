<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Case-Control Point Data Homework (Local Rates and Nearest Neighbors)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="cc-local-rates-qnn_files/libs/clipboard/clipboard.min.js"></script>
<script src="cc-local-rates-qnn_files/libs/quarto-html/quarto.js"></script>
<script src="cc-local-rates-qnn_files/libs/quarto-html/popper.min.js"></script>
<script src="cc-local-rates-qnn_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="cc-local-rates-qnn_files/libs/quarto-html/anchor.min.js"></script>
<link href="cc-local-rates-qnn_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="cc-local-rates-qnn_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="cc-local-rates-qnn_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="cc-local-rates-qnn_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="cc-local-rates-qnn_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Case-Control Point Data Homework (Local Rates and Nearest Neighbors)</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Instructions: Answer the following questions and write your answers in a word processor. Mathematical symbols should be written using the equation editor. Appropriate graphics should be included. The document may also be created in LaTeX, though this is NOT encouraged.</p>
<section id="problem-1" class="level1">
<h1>Problem 1</h1>
<p>The <code>urkiola</code> data set in the <strong>spatstat package</strong> contains locations of birch (Betula celtiberica) and oak (Quercus robur) trees in a secondary wood in Urkiola Natural Park (Basque country, northern Spain). They are part of a more extensive dataset collected and analysed by Laskurain (2008). The coordinates of the trees are given in meters. Let the “oak” trees be the cases and “birch” trees be the controls.</p>
<section id="a." class="level2">
<h2 class="anchored" data-anchor-id="a.">a.</h2>
<p>Perform a test to determine whether the most unusual window of case/control event locations in the study area can be considered a cluster using the spatial scan statistic under the random labeling hypothesis. Use <span class="math inline">\(n_sim=199\)</span> randomly labeled data sets and <span class="math inline">\(\alpha=0.10\)</span>. Make sure to clearly describe your null and alternative hypotheses. Make your conclusion in the context of the problem.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(smacpod)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.data</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.geom</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.geom 3.2-5</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.random</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.random 3.1-6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.explore</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: nlme</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.explore 3.2-3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.model</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: rpart</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.model 3.2-6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: spatstat.linnet</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>spatstat.linnet 3.1-1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
spatstat 3.0-6 
For an introduction to spatstat, type 'beginner' </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>urkiola <span class="ot">&lt;-</span> spatstat.data<span class="sc">::</span>urkiola</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>oak_scan <span class="ot">=</span> <span class="fu">spscan.test</span>(urkiola, <span class="at">nsim =</span> <span class="dv">199</span>, <span class="at">case =</span> <span class="st">"oak"</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>oak has been selected as the case group</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary of scan test results</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(oak_scan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  centroid_x centroid_y radius events cases    ex  rr stat     p
1      144.7       69.6   77.4    875   313 252.3 2.9 38.3 0.005</code></pre>
</div>
</div>
<p>The spatial scan statistic allows us to test our null hypothesis of no clustering in the study area. We find evidence of clustering (reject the null at the alpha = 0.1 level) for at least one cluster in the study area. Specifically, our null hypothesis states that none of the windows tested had a clustering of points more than we would expect under the random labeling hypothesis (RLH). The alternative hypothesis instead states that at least one window had a clustering of cases more prominent than we would expect under the RLH.</p>
</section>
<section id="b." class="level2">
<h2 class="anchored" data-anchor-id="b.">b.</h2>
<p>Using your analysis from the previous problem, create a plot of the case/control event locations, the associated study area boundary, and a legend indicating the cases/controls. Add the window identifying the most unusual window of case/control event locations (according to the spatial scan statistic) and any potential secondary clusters. Comment on the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(smacpod)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot scan test results</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(oak_scan, <span class="at">chars =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">20</span>), <span class="at">main =</span> <span class="st">"most likely cluster for urkiola tree data"</span>, <span class="at">border =</span> <span class="st">"orange"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cc-local-rates-qnn_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract most likely and other significant clusters</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">clusters</span>(oak_scan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
  [1] 1108  569  567  566  564  568 1079 1133  563  565 1107 1109  614  562 1082
 [16]  514  513  613  561  560  572  608 1110 1080 1078  515  616  612  577  603
 [31] 1083  517  609  615  558 1134  571 1081  610 1131 1084 1132  620  573 1130
 [46] 1077  516  574 1075  506  622  575  621  570  512  604 1106  611  518  507
 [61]  511  559  655  607 1157  510 1085  508  619  475 1156  578  576 1056  599
 [76] 1161  600  509 1159  579 1154 1158 1076 1160  617  618  602  605 1088 1152
 [91] 1111  550  654  580  479 1155  527 1137 1058  606  623  650  601  477 1136
[106]  583  652  476  503 1057 1135  526  557  624  627 1087  653  555  505 1153
[121]  474  554  478 1178  473 1030 1140  551 1086  525  524  523  649  504 1114
[136]  647  552 1028  582  656 1162 1029 1105 1113 1138  658 1024  426  581  423
[151]  643  683  422  528  553 1074  469 1054  692  431  651 1059 1139 1023  421
[166]  522 1025  481 1026  427 1112  480  471  548  598 1055  628  556  521 1103
[181] 1031  644 1027  625 1102  520  684 1032  657  470  428  482  519 1151 1119
[196]  648 1141  433 1020  432 1163  420  530  547  502  686  685  584  425 1063
[211] 1019  659  626  693  424  472  694  691  661 1021  689 1179 1060  438  549
[226] 1129  429 1115 1090  430 1062  439 1036 1142 1116  688  662  436 1176  645
[241] 1035  441  500 1143 1073 1022  437  585  646 1100  501 1033  687  629  435
[256]  546 1017 1200  660 1016  630 1061 1034  597  596 1015 1118 1037 1117 1177
[271]  695  632  442  719  631  468  440  434 1101  690  545  725  586  724  379
[286] 1150  595  726  998 1051  386  486 1128  385  728 1144  529  718  459 1018
[301]  663  445  997  641 1052  444  721  467  720  993  392  378 1065  992  696
[316] 1125 1089 1145 1175  377 1038  664  999  727 1174  464 1122  642 1202  722
[331]  665  414 1104  996 1146  458  723  391  587  485 1001  418  483  460 1099
[346]  376  443 1014  592 1002  393 1066  717 1201 1000  384  484  419 1120  666
[361]  532 1064  487 1003  466 1040  667  389 1039 1180 1067  463 1181  495  987
[376]  698 1185  390 1006  461  381 1092  638 1053  593  453  382  697 1091  541
[391]  383  640  636  454 1071  465  991 1126  387  380 1183  633  388  462  446
[406] 1186 1184  540  394  639  634  497  994 1203  772 1182  395  413  771  452
[421]  415  699 1004  635  375  700  455  496  416  965 1043  488 1127 1005  544
[436]  396 1165 1068 1069  973  539  971 1013  542  995  729 1205  730 1072  774
[451]  594 1219 1147  765  531  766  990  988  970 1121 1206  498  764 1164  339
[466]  736  456  543  669  768  538 1220 1042 1204  374  773  412  735 1093  969
[481]  332 1167  417  972  966  499 1094  767 1041  668  671  335  373 1007  341
[496] 1049  985  492  989  326  324 1050  535  411 1095  331 1148  670 1012  323
[511]  637  588  701  672  372  734  983 1192  457  340  778  703  337  371  370
[526]  325  491  770  336  410  984  739 1124 1166  333  780 1191  783 1209  451
[541]  775  777  334 1208  589 1149 1221 1097  338  533  781  702  963 1207  946
[556]  769  591  967  974  976  977 1190  409  677  284  493  982  986  369  537
[571]  947  494  327  975  738 1070  363  948  590  322  981 1223  731 1048  776
[586]  292  328  740  490  732  285  280 1168  283  782  942 1169  676  792  816
[601]  675 1123  536  779  365  784  674  968  362 1222  408 1231  489  785 1211
[616]  733  286  951 1189  279  450  407  945  673  786  960 1172  941  742  708
[631] 1098  276  287  827  817 1096 1187  818  964 1170  944 1210 1188  952  744
[646]  791  364  534  277  949  329  743 1171  366  275  953  278  330  288  678
[661]  793  679  980  404  291  741  704  824  737 1230  319 1011  318 1224  449
[676]  794  290  961  788  979  790  943  787  962 1234  289  405  705  750  315
[691] 1195  295  682  367  789  823  940  403  293  320  751  819  950  822  749
[706]  448  368  939  821  282  271 1010  937  281  447 1044 1199  826  321  239
[721]  820  316  954  273  825 1212  748  707  313  406  710  272  294  935 1235
[736]  274  706  747  959  314  681  938  312 1194  795  359  796  358  797  709
[751]  752 1237 1193  227  234  354  357  317  360  924  355  241 1236  831 1233
[766]  716  753 1232 1047  828  715  798 1196  927  680 1046 1173  356  829  746
[781]  745  240  236  235  936  400  830 1227  361  308  402  226  233 1213  238
[796]  711  929  754  399  762 1214  928  926  266  268  311 1045  923  346  223
[811]  242  269  237 1197  267  353  755  401  232  932  228  922  934  229 1009
[826]  222 1008  957 1225  217  799  306  925  270  264  345  714  230  347 1238
[841]  756  398 1198  847 1226  397  837  919  307  761  231  713  181  958  833
[856] 1215  978  800  918  258  760  846  218  225  712  194 1217 1216  177  834
[871]  193 1218  832  348  931</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>The result identifies the region with the most evidence of clustering, and suggests that no other window had any significant evidence of clustering.</p>
</blockquote>
</section>
<section id="c." class="level2">
<h2 class="anchored" data-anchor-id="c.">c.</h2>
<p>Perform a test for clustering using the q nearest neighbors method. Use <span class="math inline">\(q=3,5,\ldots,19\)</span> and <span class="math inline">\(n_sim=499\)</span> randomly labeled data sets. For which <span class="math inline">\(q\)</span> are there more cases than we would expect under random labeling in the <span class="math inline">\(q\)</span> locations nearest each case? At what scale does this clustering appear to occur (use the contrasts)?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># q nearest neighbor test</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qnn.test</span>(urkiola, <span class="at">q =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">15</span>), <span class="at">nsim =</span> <span class="dv">199</span>, <span class="at">case =</span> <span class="st">"oak"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>oak has been selected as the case group</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Q nearest neighbors test

case label:  oak 
control label:  birch 

Summary of observed test statistics

  q   Tq pvalue
  3  377  0.005
  5  637  0.005
  7  887  0.005
  9 1125  0.005
 11 1374  0.005
 13 1607  0.005
 15 1855  0.005

Summary of observed contrasts between test statistics

  contrast Tcontrast pvalue
   T5 - T3       260  0.005
   T7 - T3       510  0.005
   T9 - T3       748  0.005
  T11 - T3       997  0.005
  T13 - T3      1230  0.005
  T15 - T3      1478  0.005
   T7 - T5       250  0.010
   T9 - T5       488  0.005
  T11 - T5       737  0.005
  T13 - T5       970  0.005
  T15 - T5      1218  0.005
   T9 - T7       238  0.020
  T11 - T7       487  0.005
  T13 - T7       720  0.005
  T15 - T7       968  0.005
  T11 - T9       249  0.005
  T13 - T9       482  0.005
  T15 - T9       730  0.005
 T13 - T11       233  0.040
 T15 - T11       481  0.005
 T15 - T13       248  0.005</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>All q’s show significant evidence of clustering. Additionally, examining the contrasts we can see that the p-value is small enough to imply a significant difference (at the alpha=0.1 level) in clustering between all values of q.</p>
</blockquote>
</section>
</section>
<section id="problem-2" class="level1">
<h1>Problem 2</h1>
<p>Answer the same questions as Problem 1 for the <code>paracou</code> data set in the <strong>spatstat</strong> package. Let the <code>juveniles</code> be the controls and <code>adults</code> be the cases.</p>
<section id="a.-1" class="level2">
<h2 class="anchored" data-anchor-id="a.-1">a.</h2>
<p>Perform a test to determine whether the most unusual window of case/control event locations in the study area can be considered a cluster using the spatial scan statistic under the random labeling hypothesis. Use <span class="math inline">\(n_sim=199\)</span> randomly labeled data sets and <span class="math inline">\(\alpha=0.10\)</span>. Make sure to clearly describe your null and alternative hypotheses. Make your conclusion in the context of the problem.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(smacpod)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>paracou <span class="ot">&lt;-</span> spatstat.data<span class="sc">::</span>paracou</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>para_scan <span class="ot">=</span> <span class="fu">spscan.test</span>(paracou, <span class="at">nsim =</span> <span class="dv">199</span>, <span class="at">case =</span> <span class="st">"adult"</span>, <span class="at">alpha =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>adult has been selected as the case group</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in create_spscan(tobs = tobs, pvalue = pvalue, alpha = alpha, noc_info
= noc_info, : No significant clusters.  Returning most likely cluster.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary of scan test results</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(para_scan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  centroid_x centroid_y radius events cases  ex   rr stat    p
1   46.82281          2   30.5      6     4 0.3 13.9  8.3 0.15</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>We do not see strong evidence of clustering for the Paracou data when comparing the adult (cases) to the juvenile (control) locations. We cannot reject the null (no clustering) at the alpha = 0.1 level and thus cannot conclude that there are any significant clusters outside of what would be expected under the random labeling hypothesis.</p>
</blockquote>
</section>
<section id="b.-1" class="level2">
<h2 class="anchored" data-anchor-id="b.-1">b.</h2>
<p>Using your analysis from the previous problem, create a plot of the case/control event locations, the associated study area boundary, and a legend indicating the cases/controls. Add the window identifying the most unusual collection of case/control event locations (according to the spatial scan statistic) and any potential secondary clusters. Comment on the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(smacpod)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot scan test results</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(para_scan, <span class="at">chars =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">20</span>), <span class="at">main =</span> <span class="st">"most likely cluster for Paracou data"</span>, <span class="at">border =</span> <span class="st">"orange"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cc-local-rates-qnn_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract most likely and other significant clusters</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">clusters</span>(para_scan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1]  32 512 521  33  35  31</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>With no significant clusters, we plot the most likely cluster which appears rather small and on the edge of our study area. From a purely visual perspective, it appears that there may be some adult locations that could be considered a cluster but relative to the dense clusters of juveniles we do not find any of the adult location clusters to be significant.</p>
</blockquote>
</section>
<section id="c.-1" class="level2">
<h2 class="anchored" data-anchor-id="c.-1">c.</h2>
<p>Perform a test for clustering using the q nearest neighbors method. Use <span class="math inline">\(q=3,5,\ldots,19\)</span> and <span class="math inline">\(n_sim=499\)</span> randomly labeled data sets. For which <span class="math inline">\(q\)</span> are there more cases than we would expect under random labeling in the q locations nearest each case? At what scale does this clustering appear to occur (use the contrasts)?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># q nearest neighbor test</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qnn.test</span>(paracou, <span class="at">q =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">15</span>), <span class="at">nsim =</span> <span class="dv">499</span>, <span class="at">case =</span> <span class="st">"adult"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>adult has been selected as the case group</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Q nearest neighbors test

case label:  adult 
control label:  juvenile 

Summary of observed test statistics

  q Tq pvalue
  3  9  0.278
  5 14  0.314
  7 18  0.394
  9 25  0.280
 11 32  0.212
 13 36  0.242
 15 42  0.204

Summary of observed contrasts between test statistics

  contrast Tcontrast pvalue
   T5 - T3         5  0.480
   T7 - T3         9  0.578
   T9 - T3        16  0.374
  T11 - T3        23  0.252
  T13 - T3        27  0.300
  T15 - T3        33  0.266
   T7 - T5         4  0.694
   T9 - T5        11  0.400
  T11 - T5        18  0.224
  T13 - T5        22  0.302
  T15 - T5        28  0.258
   T9 - T7         7  0.226
  T11 - T7        14  0.130
  T13 - T7        18  0.232
  T15 - T7        24  0.206
  T11 - T9         7  0.226
  T13 - T9        11  0.344
  T15 - T9        17  0.286
 T13 - T11         4  0.696
 T15 - T11        10  0.470
 T15 - T13         6  0.326</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>There are no values of q for which there is evidence of clustering in the nearest q locations of each case, thus we cannot reject the null hypothesis which states that there is a significant difference in the number of observed cases for a given value of q than there should be under the random labeling hypothesis.</p>
</blockquote>
</section>
</section>
<section id="problem-3" class="level1">
<h1>Problem 3</h1>
<p>Write your own function from scratch to implement the q nearest neighbors method, including performing a Monte Carlo simulation to assess significance of your rests. You may not use any functions from the <strong>spatstat</strong> or <strong>smacpod</strong> packages.</p>
<section id="a.-2" class="level2">
<h2 class="anchored" data-anchor-id="a.-2">a.</h2>
<p>Create a function, <code>W</code>, that takes the event locations and q, the number of nearest neighbors, and returns the <code>W</code> matrix discussed in the notes. Apply this function to the <code>paracou</code> data with <code>q = 3</code>, then use the <code>image</code> function to plot the <code>W</code> matrix. Make sure to include your code here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="cf">function</span>(df, qnn) {</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">=</span> df<span class="sc">$</span>n</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">nrow=</span>N,<span class="at">ncol=</span>N)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  cases <span class="ot">=</span> df<span class="sc">$</span>marks<span class="sc">==</span><span class="st">'adult'</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  controls <span class="ot">=</span> df<span class="sc">$</span>marks<span class="sc">==</span><span class="st">'juvenile'</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N){</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    i_center <span class="ot">=</span> <span class="fu">c</span>(df<span class="sc">$</span>x[i],df<span class="sc">$</span>y[i])</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    i_vectors <span class="ot">=</span> <span class="fu">cbind</span>(df<span class="sc">$</span>x,df<span class="sc">$</span>y)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    dist_v <span class="ot">=</span> <span class="fu">apply</span>(<span class="at">X=</span>i_vectors,<span class="at">FUN=</span><span class="cf">function</span>(x){ <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">-</span>i_center)<span class="sc">^</span><span class="dv">2</span>)},<span class="at">MARGIN=</span><span class="dv">1</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    q_dist <span class="ot">=</span> <span class="fu">sort</span>(dist_v)[qnn<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    w_vector <span class="ot">=</span> <span class="fu">as.numeric</span>(dist_v<span class="sc">&lt;=</span>q_dist)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    w_vector[i] <span class="ot">&lt;-</span>  <span class="dv">0</span>  <span class="co"># do not count the event location as nearest neighbor</span></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    result[i,] <span class="ot">=</span> w_vector</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    q_length <span class="ot">=</span> <span class="fu">sum</span>(result[i,])</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (q_length<span class="sc">!=</span>qnn) {</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">"Multiple event locations equally distant from centroid. </span></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="st">              Used q = "</span>, q_length)</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>output <span class="ot">=</span> <span class="fu">w</span>(paracou,<span class="at">qnn=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  5</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  5

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  5</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  5

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  5</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  5</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  5</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  5

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  5</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4

Warning in w(paracou, qnn = 3): Multiple event locations equally distant from centroid. 
              Used q =  4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">image</span>(output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="cc-local-rates-qnn_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="b.-2" class="level2">
<h2 class="anchored" data-anchor-id="b.-2">b.</h2>
<p>Determine the <span class="math inline">\(\delta\)</span> vector discussed in the notes for the <code>paracou</code> data, using the adults as cases. Use the formula <span class="math inline">\(\delta^T W \delta\)</span> to determine <span class="math inline">\(T_q\)</span> for <span class="math inline">\(q=3\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>case_delta <span class="ot">&lt;-</span> paracou<span class="sc">$</span>marks<span class="sc">==</span><span class="st">'adult'</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>delta_transpose <span class="ot">&lt;-</span> <span class="fu">t</span>(case_delta)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>tq_obs <span class="ot">=</span> delta_transpose <span class="sc">%*%</span> output <span class="sc">%*%</span> case_delta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="c.-2" class="level2">
<h2 class="anchored" data-anchor-id="c.-2">c.</h2>
<p>Generate 499 data sets under the random labeling hypothesis for the paracou data, using the adults as cases. Determine <span class="math inline">\(T_q\)</span> for each simulated data set for <span class="math inline">\(q=3\)</span>. Compute the sample mean and variance for the statistics coming from the NULL data (do not include the observed statistic). Compute the Monte Carlo p-value for this test using the observed statistics and the 499 statistics from the simulated data. Make sure to provide your code and clearly indicate the sample mean, sample variance, and Monte Carlo p-value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> paracou</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>q <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> df<span class="sc">$</span>n</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>xmin <span class="ot">=</span> <span class="fu">min</span>(df<span class="sc">$</span>x)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>xmax <span class="ot">=</span> <span class="fu">max</span>(df<span class="sc">$</span>x)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>ymin <span class="ot">=</span> <span class="fu">min</span>(df<span class="sc">$</span>y)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>ymax <span class="ot">=</span> <span class="fu">max</span>(df<span class="sc">$</span>y)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>nsims <span class="ot">=</span> <span class="dv">499</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>sim_stats <span class="ot">=</span> <span class="fu">vector</span>()</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nsims) {</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  xvals <span class="ot">=</span> <span class="fu">runif</span>(N,xmin,xmax)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  yvals <span class="ot">=</span> <span class="fu">runif</span>(N,ymin,ymax)</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  r_events <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">1</span>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  case_labels <span class="ot">=</span> <span class="fu">as.numeric</span>(<span class="fu">runif</span>(N)<span class="sc">&gt;</span>r_events)</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  temp_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">n=</span>N,xvals,yvals,case_labels)</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>  temp_w <span class="ot">&lt;-</span> <span class="fu">w</span>(temp_data,q)</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>  temp_delta <span class="ot">&lt;-</span> temp_data<span class="sc">$</span>case_labels<span class="sc">==</span><span class="dv">1</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>  temp_delta_t <span class="ot">&lt;-</span> <span class="fu">t</span>(temp_delta)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>  tq_stat <span class="ot">=</span> temp_delta_t <span class="sc">%*%</span> temp_w <span class="sc">%*%</span> temp_delta</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>  sim_stats[i] <span class="ot">=</span> tq_stat</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>sim_mean <span class="ot">=</span> <span class="fu">mean</span>(sim_stats)</span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>sim_var <span class="ot">=</span> <span class="fu">var</span>(sim_stats)</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a>monte_carlo_p <span class="ot">=</span> <span class="fu">mean</span>(<span class="fu">c</span>(tq_obs,sim_stats)<span class="sc">&gt;=</span>tq_obs[<span class="dv">1</span>])</span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Sample Statistic Mean: "</span>, sim_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Sample Statistic Mean:  889.122244488978"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Sample Statistic Variance: "</span>, sim_var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Sample Statistic Variance:  648610.701893747"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"Observed Statistic Monte Carlo P-Value: "</span>, monte_carlo_p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Observed Statistic Monte Carlo P-Value:  0.936"</code></pre>
</div>
</div>
</section>
</section>
<section id="problem-4" class="level1">
<h1>Problem 4</h1>
<p>Describe how the set of windows considered for the spatial scan method are constructed. More specifically, consider a specific event location. What would the first window be? What would the next window be for that even location? And so on.</p>
<blockquote class="blockquote">
<p>The set of windows considered for the spatial scan method are constructed by generating circles of variable radius ranging from 0 to some user-defined value (typically half of the width of the study area) on a grid, typically following our event locations. The first window would be a single point of radius 0 at the first of our event locations. The next window at that location would expand until it reached another event location, at which point all radii between the first and second window provide no additional information.</p>
</blockquote>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>